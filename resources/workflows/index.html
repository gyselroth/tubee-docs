



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Workflows - tubee</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#workflows" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="tubee" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              tubee
            </span>
            <span class="md-header-nav__topic">
              
                Workflows
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="tubee" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    tubee
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About tubee" class="md-nav__link">
      About tubee
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quick-start/" title="Quick start" class="md-nav__link">
      Quick start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced/best-practics/" title="Best practics" class="md-nav__link">
      Best practics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced/scripting/" title="Scripting" class="md-nav__link">
      Scripting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced/tubectl-config/" title="tubectl config" class="md-nav__link">
      tubectl config
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../operations/apply/" title="Apply from file" class="md-nav__link">
      Apply from file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operations/create/" title="Create resources" class="md-nav__link">
      Create resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operations/delete/" title="Delete resources" class="md-nav__link">
      Delete resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operations/edit/" title="Modify resources" class="md-nav__link">
      Modify resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operations/get/" title="Request & Query resources" class="md-nav__link">
      Request & Query resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Resources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-objects/" title="DataObjects" class="md-nav__link">
      DataObjects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-relation-objects/" title="DataRelationObjects" class="md-nav__link">
      DataRelationObjects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../endpoints/" title="Endpoints" class="md-nav__link">
      Endpoints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../namespaces/" title="Namespaces" class="md-nav__link">
      Namespaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/" title="Secrets" class="md-nav__link">
      Secrets
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Workflows
      </label>
    
    <a href="./" title="Workflows" class="md-nav__link md-nav__link--active">
      Workflows
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-workflow" class="md-nav__link">
    Create workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ensure" class="md-nav__link">
    Ensure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#condition" class="md-nav__link">
    Condition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#priority" class="md-nav__link">
    Priority
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapping" class="md-nav__link">
    Mapping
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#name" class="md-nav__link">
    Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kind" class="md-nav__link">
    Kind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure_1" class="md-nav__link">
    Ensure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type" class="md-nav__link">
    Type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite" class="md-nav__link">
    Rewrite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unwind" class="md-nav__link">
    Unwind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skip" class="md-nav__link">
    Skip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writeonly" class="md-nav__link">
    Writeonly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" class="md-nav__link">
    Filter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Sdk
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Sdk
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      Nodejs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        Nodejs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sdk/nodejs/" title="tubee node.js SDK with typescript support" class="md-nav__link">
      tubee node.js SDK with typescript support
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/" title="tubee" class="md-nav__link">
      tubee
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/contribute/" title="Contribute to tubee" class="md-nav__link">
      Contribute to tubee
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/installation-helm/" title="Installation helm" class="md-nav__link">
      Installation helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/installation/" title="Deploy Server" class="md-nav__link">
      Deploy Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../server/upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Tubectl
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Tubectl
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tubectl/" title="tubectl" class="md-nav__link">
      tubectl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tubectl/changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tubectl/contribute/" title="Contribute to tubee-client-cli" class="md-nav__link">
      Contribute to tubee-client-cli
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tubectl/upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-workflow" class="md-nav__link">
    Create workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ensure" class="md-nav__link">
    Ensure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#condition" class="md-nav__link">
    Condition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#priority" class="md-nav__link">
    Priority
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapping" class="md-nav__link">
    Mapping
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#name" class="md-nav__link">
    Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kind" class="md-nav__link">
    Kind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure_1" class="md-nav__link">
    Ensure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type" class="md-nav__link">
    Type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite" class="md-nav__link">
    Rewrite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unwind" class="md-nav__link">
    Unwind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skip" class="md-nav__link">
    Skip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writeonly" class="md-nav__link">
    Writeonly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" class="md-nav__link">
    Filter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="workflows">Workflows</h1>
<p>A workflow defines how attributes are mapped between tubee and an endpoint. Workflows are required for both a source and a destination endpoint.
For source endpoints a worklfow specifies what attributes from an endpoint are mapped to a tubee DataObject. The same is true for destination endpoint workflows
but just reversed. Such a workflow defines what tubee attributes get mapped to a destination endpoint.</p>
<p>Each endpoint may have more than one workflow however only one workflow can get selected and executed.
What workflow is selected depends on what ensure type is set or if a condition allows the worklfow to get executed.</p>
<h2 id="create-workflow">Create workflow</h2>
<p>This will create a workflow for the endpoint named <code>ldap</code> within the collection <code>accounts</code>.</p>
<pre><code class="yaml">name: create-update
kind: Workflow
namespace: playground
collection: accounts
endpoint: ldap
data:
  priority: 0
  ensure: last
  condition: &quot;core.result(core.object.data.disabled === false &amp;&amp; core.object.data.username)&quot;
  map:
  - name: entrydn
    kind: script
    value: &quot;core.result('uid='+core.object.data.username+',ou='+core.object.department+',o=company,dc=example,dc=org')&quot;
    required: true
  - name: uid
    kind: map
    value: data.username
    required: false
  - name: sn
    kind: map
    value: data.last_name
    required: false
  - name: givenName
    kind: map
    value: data.givenname
    required: false
  - name: cn
    kind: script
    value: &quot;core.result(core.object.data.firstname +' '+core.object.data.last_name)&quot;
    required: false
  - name: objectClass
    kind: static
    value: 
      - inetOrgPerson
    required: true
</code></pre>

<pre><code class="sh">tubectl create -f spec.yaml
</code></pre>

<p>Check the just created resource:</p>
<pre><code class="sh">tubectl get wf accounts ldap create-update -n playground -o yaml
</code></pre>

<h2 id="ensure">Ensure</h2>
<p>The ensure type defines what the workflow actually should do. It defines in what state a <a href="resources/data-objects.md">DataObject</a> or an <a href="resources/endpoint-objects.md">EndpointObject</a> should be. 
There are three known ensure types:</p>
<table>
<thead>
<tr>
<th>Ensure</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>exists</td>
<td>The resource gets created if it does not already exists.</td>
</tr>
<tr>
<td>last</td>
<td>The resource gets created if it does not already exists and if it does the resource gets updated.</td>
</tr>
<tr>
<td>absent</td>
<td>The resource gets removed.</td>
</tr>
</tbody>
</table>
<p>The default ensure type for a workflow is always <code>last</code>.</p>
<h2 id="condition">Condition</h2>
<p>Each workflow may have a scripted condition. This condition gets execute and determines if a given workflow shall get executed.
The condition is JavaScript and gets executed by googles <a href="https://github.com/v8/v8">V8</a> engine.
The condition has to execute <code>core.result(&lt;bool&gt;)</code> to define if the workflow should get executed.
Each object traverses the workflow stack and gets tested against each workflow as soon as one workflow matches.
Each currently processed object is available at <code>core.object</code>.</p>
<p>Example:</p>
<pre><code class="js">core.result(core.object.data.disabled === false &amp;&amp; core.object.data.username)
</code></pre>

<p>This workflow only gets executed if the object has a property <code>disabled</code> with a value <code>false</code> and has a field <code>username</code> set.</p>
<blockquote>
<p><strong>Note</strong> By default there is no condition. A workflow may only match if the ensure type does match.</p>
</blockquote>
<h2 id="priority">Priority</h2>
<p>Besides a condition and the ensure type there is possibility to set a priority in which order the workflows get tested.
By default each workflow has the priority <code>0</code>.
<code>0</code> is the highest priority. A workflow with the priority <code>0</code> gets executed before a worklfow with the priority <code>2</code>.</p>
<h2 id="mapping">Mapping</h2>
<p>The mapping is the most important fact about a workflow. The mapping defines what and how certain attributes get mapped to each other.
For example it defines what attributes from a <a href="resources/data-objects.md">DataObject</a> get mapped to what attributes of an OpenLDAP object.
The mapping is defined within <code>map</code> and contains a list of attribute mappings. Each attribute mapping may have different options.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td><code>&lt;required&gt;</code></td>
<td>The name of the destination attribute. (May also contain <code>.</code> to specify a deep path like <code>data.username</code>).</td>
</tr>
<tr>
<td>kind</td>
<td><code>map</code></td>
<td>May either be <code>map</code> (1:1 attribute mapping), <code>static</code> (static inline value) or <code>script</code> (scripted attribute using vanilla javascript (V8).</td>
</tr>
<tr>
<td>ensure</td>
<td><code>last</code></td>
<td>Like a workflow itself, each attribute may have a different ensure level.</td>
</tr>
<tr>
<td>value</td>
<td><code>null</code></td>
<td>Defines the value of the attribute. The value depends on what kind of attribute this is.</td>
</tr>
<tr>
<td>type</td>
<td><code>&lt;same type as value&gt;</code></td>
<td>Convert the value to another type.</td>
</tr>
<tr>
<td>rewrite</td>
<td><code>[]</code></td>
<td>Rewrite a mapped attribute to another value (May also be done using a scripted attribute).</td>
</tr>
<tr>
<td>filter</td>
<td><code>[]</code></td>
<td>Chain of predefined string filters to apply</td>
</tr>
<tr>
<td>unwind</td>
<td><code>null</code></td>
<td>Unwind a list and operate attribute options on each list element.</td>
</tr>
<tr>
<td>skip</td>
<td><code>false</code></td>
<td>If true the attribute gets ignored. This may be useful if an attribute is only used for an object relation creation or relation context.</td>
</tr>
<tr>
<td>map</td>
<td><object></td>
<td>Define an object relation mapping to another collection. Automatically create DataObjectReations.</td>
</tr>
<tr>
<td>writeonly</td>
<td><code>false</code></td>
<td>Writeonly flag may be set to true for attributes which get not returned by endpoints (writeonly attributes).</td>
</tr>
</tbody>
</table>
<h3 id="name">Name</h3>
<p>The name is required and defines the name of the destination attribute name. </p>
<blockquote>
<p><strong>Note</strong> Important, DataObject attributes are usually in the data container.  </p>
</blockquote>
<p>For example, lets define an attribute from an active directory source endpoint and map the samAccountName to our DataObject.</p>
<pre><code class="yaml">map:
- name: data.username
  from: samAccountName
</code></pre>

<p>The <code>data.</code> prefix is required since a DataObjects data is placed within a data container. See an example of a DataObject <a href="resources/data-objects.md">here</a>.</p>
<h3 id="kind">Kind</h3>
<p>There are three different attribute kinds while map is the default one.</p>
<table>
<thead>
<tr>
<th>Kind</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>map</td>
<td>The value will hold the name of the source attribute from which value will be taken. The value must be string in this case since all attribute names are strings.</td>
</tr>
<tr>
<td>static</td>
<td>The value is a static value. It may be any supported type.</td>
</tr>
<tr>
<td>script</td>
<td>The value is a javascript executed by the V8 engine. The result must set by calling <code>core.result()</code> while the current DataObject is accessible using <code>core.object</code>.</td>
</tr>
</tbody>
</table>
<h3 id="ensure_1">Ensure</h3>
<p>The ensure type on a attributes knows one more type <code>merge</code> compared to workflow itself.</p>
<table>
<thead>
<tr>
<th>Ensure</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>exists</td>
<td>The attribute gets only mapped if it does not exists yet.</td>
</tr>
<tr>
<td>last</td>
<td>The attribute gets mapped with the latest value.</td>
</tr>
<tr>
<td>absent</td>
<td>The attribute gets removed.</td>
</tr>
<tr>
<td>merge</td>
<td>The attributes get merged, only useful if the value is an array/list.</td>
</tr>
</tbody>
</table>
<p>Defines mighty scipted attributes. The engine executes JavaScript and used the result of <code>core.result()</code> as the value for the attribute.</p>
<h3 id="type">Type</h3>
<p>By default the source attributes type will be untouched. However you may convert the value to another type.
The same attribute types as defined in a <a href="resources/collections.md#schema">collection schema</a> are available.</p>
<blockquote>
<p><strong>Note</strong> The type conversion takes place at the very end of the attribute mapping.</p>
</blockquote>
<h3 id="rewrite">Rewrite</h3>
<p>You may use rewrite rules to rewrite a value. Rewrite rules may either be of static matching using <code>from</code> or 
a regex (<a href="https://www.pcre.org/">PCRE</a>) matching using <code>match</code>.
The rewrite processor stops as soon as either <code>from</code> or a regex <code>match</code> match the given attributes value.</p>
<p>Example:</p>
<pre><code class="yaml">map:
- name: entrydn
  kind: script
  value: &quot;core.result('uid='+core.object.data.username+',ou='+core.object.department+',o=company,dc=example,dc=org')&quot;  
  rewrite:
  - from: uid=admin,ou=admins,o=company,dc=example,dc=org
    to: uid=Administrator,ou=admins,o=company,dc=example,dc=org
  - match: #uid=([^,]),ou=hr,o=company,dc=example,dc=org#
    to: uid=$2,ou=secretariat,o=company,dc=example,dc=org
  - match: #uid=([^,]),ou=assistence,o=company,dc=example,dc=org#
    to: uid=$2,ou=secretariat,o=company,dc=example,dc=org
</code></pre>

<blockquote>
<p><strong>Note</strong> Rewrite rules get execute once the value is determined from either from,value or script but before a possible type conversion.</p>
</blockquote>
<p>You may achive the same using scripted attributes. But rewrite rules are a more readable way and should be the preferred choice if you need
to rewrite any values.</p>
<h3 id="unwind">Unwind</h3>
<p>Using unwind you may operate on each element within a list attribute. You may apply each attribute mapping option to a unwind operator.</p>
<p>For example, we have a <a href="resources/data-objects.md">DataObject</a> with an attribute adresses which is a list of adresses and we want to 
map all streets to an attribute called street.</p>
<p>DataObject:</p>
<pre><code class="yaml">kind: DataObject
collection: people
data:
  firstName: John
  lastName: Meyer
  adresses: 
  - street: First street 20
    zip: 33445
    city: New York
  - street: Company street 38
    zip: 3445
    city: Zurich
</code></pre>

<p>The goal is to get an attribute called street with the value <code>['First street 20', 'Company street 38']</code>.
Lets unwind the attribute <code>adresses</code> and grab the value with <code>from</code>.</p>
<blockquote>
<p><strong>Note</strong> While unwindig the each list value gets available at <code>root</code>.</p>
</blockquote>
<pre><code class="yaml">map:
- name: street
  value: data.adresses
  unwind:
    from: root.street
</code></pre>

<p>The same is achievable using scripted attributes, but like rewrite rules, unwinding may be the preferrable solution.</p>
<p>### Map</p>
<p>Map is particulary useful to automatically create DataObjectRelations between DataObjects. DataObjectRelations represent a relationship between two (or more) DataObjects.
Those DataObject may be from different collections and/or namespaces.</p>
<p>Lets asume we have a collection named <code>accounts</code> and one named <code>groups</code>.
We would like to import LDAP objects into both of them. Into accounts we import person objects and into group group objects.
While importing we'd like to automatically create tubee DataObjectRelations between group and group members. 
Lets asume those LDAP group objects have an attribute <code>member</code> which is a list of user distinguished names.
To automatically create a relationship we need to specify the <code>map</code> keyword and pointing the destination collection to <code>accounts</code> and
the key which gets used to identify the destination account object to <code>data.dn</code> (data.dn will hold the account dn).</p>
<p>Optionally we set an attribute <code>ou</code> as context.</p>
<p>Example:</p>
<pre><code class="yaml">map:
- name: data.member
  value: member
  map:
    collection: accounts
    to: data.dn
    context:
    - ou
  skip: true
- name: data.ou
  from: ou
  skip: true
</code></pre>

<p>This mapping will automatically try to create DataObjectRelations between those two collections.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>collection</td>
<td><code>&lt;required&gt;</code></td>
<td>The name of the destination collection.</td>
</tr>
<tr>
<td>to</td>
<td><code>&lt;required&gt;</code></td>
<td>The name of the DataObject in the destination collection to use as relationship reference. (Usually you will ned to specify the attribute within data. (for example data.id)).</td>
</tr>
<tr>
<td>ensure</td>
<td><code>last</code></td>
<td>By default the relationship gets created and updated. You may set ensure to <code>exists</code> or <code>absent</code> while on exists the relation will not get updated (for example if context data gets changed). If absent the relation gets removed.</td>
</tr>
<tr>
<td>context</td>
<td><code>&lt;empty list&gt;</code></td>
<td>A list of attributes to use as context attributes. (Note that you can also use attributes which have <code>skip: true</code> set.)</td>
</tr>
</tbody>
</table>
<h3 id="skip">Skip</h3>
<p>Skip is by default false. An attribute which has skip on <code>true</code> is declared as a virtual attribute and never gets written anywhere. 
However a skip: true attribute may be useful if it gets used to write a DataObjectRelation context (See <a href="#Map">Map</a>).</p>
<h3 id="writeonly">Writeonly</h3>
<p>A password attribute is an example for such attributes. Passwords usually may be writeable but get not returned. While writeonly is set to true and DataObject already exists on the endpoint, the attribute does not get written. writeonly: true attributes may only get written during object creation. Note that it does not matter what value <code>ensure</code> holds while the attribute is set on writeonly and the DataObject already exists.</p>
<h3 id="filter">Filter</h3>
<p>Specify an optional chain of filters to apply as string filters:</p>
<ul>
<li>Alnum</li>
<li>Alpha</li>
<li>BaseName</li>
<li>Digits</li>
<li>Dir</li>
<li>HtmlEntities</li>
<li>RealPath</li>
<li>StringPrefix</li>
<li>StringSuffix</li>
<li>StringToLower</li>
<li>StringToUpper</li>
<li>StringTrim</li>
<li>StripNewlines</li>
<li>StripTags</li>
<li>UriNormalize</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../secrets/" title="Secrets" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Secrets
              </span>
            </div>
          </a>
        
        
          <a href="../../sdk/nodejs/" title="tubee node.js SDK with typescript support" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                tubee node.js SDK with typescript support
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>